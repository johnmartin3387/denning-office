{% extends "base.html" %}
{% load static %}
{% load custom_tag %}

{% block meta_description %}

{% endblock %}

{% block extra_css %}
<link href="{% static 'global/plugins/bootstrap-daterangepicker/daterangepicker.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}
{% block title %} Matter Code <button type="button" class="btn btn-primary edit-btn" style="float: right">Edit Form</button> {% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-6 ">
        <!-- BEGIN SAMPLE FORM PORTLET-->
        <div class="portlet box purple ">
            <div class="portlet-title">
                <div class="caption">
                     Matter Information </div>
                <div class="tools">
                    <a href="javascript: alert();" data-toggle="modal" class="config edit-tool" data-original-title="" title=""> </a>
                    <a href="javascript:;" class="edit-form edit-tool" onclick="appendForm(this, 'col-md-6')"> </a>
                    <a href="" class="collapse"> </a>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form" class="form-horizontal">
                    <div class="form-body">
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="matter_code">Matter Code</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="matter_code" placeholder="Enter matter code" name="matter_code">
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="matter">Matter</label>
                            <div class="col-md-8">
                                <textarea class="form-control" rows="6" name="matter"></textarea>
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="category">Category</label>
                            <div class="col-md-8 input-group-control">
                                <div class="input-group input-group-sm">
                                    <div class="input-group-control">
                                        <select class="form-control" id="category" name="category">
                                            <option value="">Option 1</option>
                                            <option value="">Option 2</option>
                                            <option value="">Option 3</option>
                                            <option value="">Option 4</option>
                                        </select>
                                    </div>
                                    <span class="input-group-btn btn-right">
                                        <a href="javascript:;" class="btn btn-icon-only blue">
                                            <i class="fa fa-search"></i>
                                        </a>
                                    </span>
                                </div>
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="edit_form">Edit Form</label>
                            <div class="col-md-8">
                                <select class="form-control" id="edit_form" name="edit_form">
                                    <option value="">Option 1</option>
                                    <option value="">Option 2</option>
                                    <option value="">Option 3</option>
                                    <option value="">Option 4</option>
                                </select>
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="turnarround_days">Turn arround Time (Days)</label>
                            <div class="col-md-8">
                                <input type="number" class="form-control" id="turnarround_days" placeholder="Enter project name" name="turnarround_days">
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="checklist">Preset Checklist</label>
                            <div class="col-md-8 input-group-control">
                                <div class="input-group input-group-sm">
                                    <div class="input-group-control">
                                        <select class="form-control" id="checklist" name="checklist">
                                            <option value="">Option 1</option>
                                            <option value="">Option 2</option>
                                            <option value="">Option 3</option>
                                            <option value="">Option 4</option>
                                        </select>
                                    </div>
                                    <span class="input-group-btn btn-right">
                                        <a href="javascript:;" class="btn btn-icon-only blue">
                                            <i class="fa fa-search"></i>
                                        </a>
                                    </span>
                                </div>
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                        <div class="form-group form-md-line-input has-success">
                            <label class="col-md-4 control-label" for="billing_code">Billing Code</label>
                            <div class="col-md-8 input-group-control">
                                <div class="input-group input-group-sm">
                                    <div class="input-group-control">
                                        <select class="form-control" id="billing_code" name="billing_code">
                                            <option value="">Option 1</option>
                                            <option value="">Option 2</option>
                                            <option value="">Option 3</option>
                                            <option value="">Option 4</option>
                                        </select>
                                    </div>
                                    <span class="input-group-btn btn-right">
                                        <a href="javascript:;" class="btn btn-icon-only blue">
                                            <i class="fa fa-search"></i>
                                        </a>
                                    </span>
                                </div>
                                <div class="form-control-focus"> </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- END SAMPLE FORM PORTLET-->
    </div>
    <div class="col-md-6 ">
        <!-- BEGIN SAMPLE FORM PORTLET-->
        <div class="portlet box purple ">
            <div class="portlet-title">
                <div class="caption">
                     <span class="header-static">Matter Information</span> <input type="text" class="form-control input-sm edit-tool header-edit"> </div>
                <div class="tools">
                    <a href="" class="collapse"> </a>
                    <a href="" class="fullscreen edit-tool" data-original-title="" title="" onclick="editForm(this)"> </a>
                    <a href="javascript:;" class="edit-form edit-tool" onclick="appendForm(this, 'col-md-6')"> </a>
                    <a href="" class="remove-form edit-tool" data-original-title="" title="" onclick="removeForm(this)"> </a>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form" class="form-horizontal">
                    <div class="form-body">
                        <div class="row" id="myformbuilder">
                        </div>
                        <div class="row" id="myformrenderer">
                        </div>
                        <div class="form-content">
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- END SAMPLE FORM PORTLET-->
    </div>
</div>
{% endblock %}

{% block extra_js %}

<script src="{% static 'global/plugins/moment.min.js" type="text/javascript' %}"></script>
<script src="{% static 'global/plugins/bootstrap-daterangepicker/daterangepicker.min.js' %}" type="text/javascript"></script>
<script src="{% static 'global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}" type="text/javascript"></script>
<script src="{% static 'global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js' %}" type="text/javascript"></script>
<script src="{% static 'global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js' %}" type="text/javascript"></script>

<script src="{% static 'formbuilder/js/jquery-ui.min.js' %}" type="text/javascript"></script>
<script src="{% static 'formbuilder/js/form-builder.min.js' %}" type="text/javascript"></script>
<script src="{% static 'formbuilder/js/form-render.min.js' %}" type="text/javascript"></script>

<script type="text/javascript">

if (App.isAngularJsApp() === false) {
    if (jQuery().datepicker) {
        $(".form_datetime").datetimepicker({
            autoclose: true,
            isRTL: App.isRTL(),
            format: "dd MM yyyy - hh:ii",
            pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
        });

        $('body').removeClass("modal-open"); // fix bug when inline picker is used in modal
        // Workaround to fix datetimepicker position on window scroll
        $( document ).scroll(function(){
            $('.form_datetime').datetimepicker('place'); //#modal is the id of the modal
        });
    }
}

// initialize the global values
let mode = 0
let edit_form_mode = 0
var formBuilder = null
var jsonData = null

$(document).ready(function(){
    
    $(".edit-tool").attr("style", "display:none;")
    $(".edit-btn").click(function(){
        if(mode == 0){
            mode = 1
            $(".edit-btn").html("Save Form")
            $(".edit-tool").attr("style", "")
            $(".header-static").attr("style", "display:none;")
            $( ".header-static" ).each(function( index ) {
                $( this ).next().val($( this ).html())
            });
        }
        else{
            mode = 0
            $(".edit-btn").html("Edit Form")
            $(".edit-tool").attr("style", "display:none;")
            $(".header-static").attr("style", "")
            
            $( ".header-edit" ).each(function( index ) {
                $( this ).prev().html($( this ).val())
            });
        }
    })
})

function getFormBuilder(indicator){
    var options = {
      disabledAttrs: ["value", "className", "name", "access", "help"],
      disabledActionButtons: ['data', 'clear', 'save']
    };
    return $(indicator).formBuilder(options);
}

function appendForm(obj, clss){
    str = '<div class="portlet box purple "> \
            <div class="portlet-title"> \
                <div class="caption"> \
                     <span class="header-static" style="display: none">Matter Information</span> <input type="text" class="form-control input-sm edit-tool header-edit"> </div> \
                <div class="tools"> \
                    <a href="" class="collapse"> </a> \
                    <a href="" class="fullscreen edit-tool" data-original-title="" title="" onclick="editForm(this)"> </a> \
                    <a href="javascript:;" class="edit-form edit-tool" onclick="appendForm(this, \'col-md-6\')"> </a> \
                    <a href="javascript:;" class="remove-form edit-tool" data-original-title="" title="" onclick="removeForm(this)"> </a> \
                </div> \
            </div> \
            <div class="portlet-body form"> \
                <form role="form" class="form-horizontal"> \
                    <div class="form-body"> \
                    </div> \
                </form> \
            </div> \
        </div>'
    $(str).insertAfter($(obj).parent().parent().parent())
}

function genRand() {
  return Math.floor(Math.random()*89999+10000);
}

function slugify(string) {
  return string
    .toString()
    .trim()
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^\w\-]+/g, "")
    .replace(/\-\-+/g, "-")
    .replace(/^-+/, "")
    .replace(/-+$/, "");
}

function editForm(obj){
    if(edit_form_mode == 0){
        randNum = genRand().toString()
        str = '<div class="row" id="myformbuilder-'+ randNum +'"> \
                </div>'
        $(obj).parent().parent().next().children().eq(0).children().eq(0).html(str)

        formBuilder = getFormBuilder('#myformbuilder-' + randNum);
        edit_form_mode = 1
    }else{
        $(obj).parent().parent().next().children().eq(0).children().eq(0).html("")
        edit_form_mode = 0

        if(formBuilder != null){
            jsonData = formBuilder.actions.getData('json', true)
            json = convertBJsonToRJson(jsonData)
            html = convertJsonToHtml(json)
            $(obj).parent().parent().next().children().eq(0).children().eq(0).html(html)
        }
    }
}

// convert FormBuilder Json into the json data for metronics form
function convertBJsonToRJson(jsonData){
    jsonData = JSON.parse(jsonData)
    for(var idx=0; idx<jsonData.length; idx++){
        console.log(jsonData[idx])
    }
    return jsonData
}

// convert json data into html string
function convertJsonToHtml(jsonData){
    html = ""
    for(var idx=0; idx<jsonData.length; idx++){
        element = jsonData[idx]
        var placeholder = element["placeholder"]
        if(placeholder == undefined)
            placeholder = ""

        // for input element
        if(element["type"] == "text" || element["type"] == "number"){
            var type = element["subtype"]
            if(type == undefined)
                type = element["type"]
            html += '<div class="form-group form-md-line-input has-success"> \
                <label class="col-md-4 control-label">'+ element["label"] +'</label> \
                <div class="col-md-8"> \
                    <input type="' + type + '" class="form-control" placeholder="'+ placeholder +'" name="'+ slugify(element['label']) +'"> \
                    <div class="form-control-focus"> </div> \
                </div> \
            </div>'
        }
            
    }
    return html
}

function removeForm(obj){
    $(obj).parent().parent().parent().remove()
}
</script>
{% endblock %}
